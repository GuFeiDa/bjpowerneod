<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bjpowernode.crm.workbench.dao.TransactionDao">

   <!--List<String> getCustomerName(String name);-->
    <select id="getCustomerName" resultType="string">
        SELECT
          NAME
        FROM
          tbl_customer
        WHERE NAME LIKE '%' #{name} '%'
    </select>

    <!--Tran findById(String id);-->
    <select id="findById" resultType="Tran">
        SELECT
        t.id ,
        t.money ,
        t.name ,
        t.expectedDate ,
        t.stage ,
        t.type ,
        t.source ,
        t.createBy ,
        t.createTime ,
        t.editBy ,
        t.editTime ,
        t.description ,
        t.contactSummary ,
        t.nextContactTime ,
        cu.name AS customerId,
        co.fullname AS contactsId,
        u.name AS OWNER,
        a.name AS activityId
        FROM
        tbl_tran t , tbl_customer cu , tbl_contacts co , tbl_user u , tbl_activity a
        WHERE
        t.id = #{id}
        AND
        t.owner = u.id
        AND
        t.activityId = a.id
        AND
        t.customerId = cu.id
        AND
        t.contactsId = co.id
    </select>

    <!--void updateTransaction(Tran tran);-->
    <update id="updateTransaction" >
        update tbl_tran set stage=#{stage} where id = #{id}
    </update>

</mapper>